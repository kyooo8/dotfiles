name: Ubuntu

on:
  push:

jobs:
  install:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      - name: install homebrew
        run: |
          /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
          echo 'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"' >> ~/.bashrc
          eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
      - name: install yadm
        run: |
          eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
          brew install yadm
          yadm --version
      - name: clone dotfiles
        run: |
          eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
          yadm clone --branch use-yadm https://github.com/kyooo8/dotfiles.git
          yadm status
      - name: Check nvim
        run: |
          eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
          nvim -E -s <<'EOF'
          :source $HOME/.config/nvim/init.lua
          :Lazy install
          :Lazy health
          :qa
          EOF
