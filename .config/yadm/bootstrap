#!/bin/sh

system_type=$(uname -s)

if [ "$system_type" = "Linux" ]; then
  if ! command -v brew >/dev/null 2>&1; then
    echo "Installing Homebrew (Linux)"
    NONINTERACTIVE=1 /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    echo 'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"' >> ~/.bashrc
    eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
  else
    eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
  fi
fi

REPO=$(yadm rev-parse --show-toplevel)
cd "$REPO" 
if [ -f "$REPO/Brewfile" ]; then
  echo "Updating homebrew bundle"
  brew bundle --file "$REPO/Brewfile"
else
  echo "no brewfile found at $REPO"
fi

